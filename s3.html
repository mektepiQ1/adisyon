<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garson Paneli - Paşam Döner</title>
    <style>
        :root {
            --primary: #1a1a2e;
            --secondary: #16213e;
            --accent: #0f3460;
            --highlight: #e94560;
            --success: #00b894;
            --warning: #fdcb6e;
            --danger: #e74c3c;
            --light: #f7f7f7;
            --dark: #2d3436;
            --text: #333333;
            --text-light: #777777;
            --border: #e0e0e0;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 20px 0;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            font-size: 32px;
        }
        
        .current-time {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 500;
            backdrop-filter: blur(10px);
        }
        
        .nav-tabs {
            display: flex;
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
        }
        
        .nav-tab {
            flex: 1;
            padding: 18px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 16px;
            position: relative;
            overflow: hidden;
        }
        
        .nav-tab:not(.active):hover {
            background-color: rgba(15, 52, 96, 0.05);
        }
        
        .nav-tab.active {
            background: linear-gradient(to right, var(--accent), var(--highlight));
            color: white;
        }
        
        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: white;
        }
        
        .tab-content {
            display: none;
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title::after {
            content: '';
            flex: 1;
            height: 2px;
            background: linear-gradient(to right, var(--primary), transparent);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(15, 52, 96, 0.1);
        }
        
        .location-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .location-btn {
            flex: 1;
            padding: 18px;
            text-align: center;
            background-color: var(--light);
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .location-btn i {
            font-size: 24px;
        }
        
        .location-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }
        
        .location-btn.active {
            background: linear-gradient(135deg, var(--accent), var(--highlight));
            color: white;
            border-color: var(--accent);
            box-shadow: var(--shadow);
        }
        
        .location-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .location-section.active {
            display: block;
        }
        
        .products-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .product-category {
            margin-bottom: 30px;
        }
        
        .category-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--accent);
            color: var(--primary);
        }
        
        .product-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .product-name {
            font-weight: 700;
            font-size: 18px;
            color: var(--primary);
        }
        
        .product-price {
            color: var(--success);
            font-weight: 700;
            font-size: 18px;
            background: rgba(0, 184, 148, 0.1);
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        .product-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: auto;
        }
        
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quantity-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: var(--light);
            color: var(--dark);
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .quantity-btn:hover {
            background: var(--accent);
            color: white;
        }
        
        .quantity-display {
            font-weight: 700;
            font-size: 18px;
            min-width: 30px;
            text-align: center;
        }
        
        .add-product-btn {
            background: linear-gradient(to right, var(--success), #00a085);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .add-product-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 184, 148, 0.3);
        }
        
        .order-summary {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border-left: 5px solid var(--accent);
        }
        
        .order-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .order-item:last-child {
            border-bottom: none;
        }
        
        .order-item-info {
            display: flex;
            flex-direction: column;
        }
        
        .order-item-name {
            font-weight: 600;
        }
        
        .order-item-price {
            color: var(--text-light);
            font-size: 14px;
        }
        
        .order-item-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .order-item-quantity {
            font-weight: 600;
            min-width: 30px;
            text-align: center;
        }
        
        .remove-item-btn {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .remove-item-btn:hover {
            transform: scale(1.1);
        }
        
        .order-total {
            display: flex;
            justify-content: space-between;
            font-weight: 700;
            font-size: 22px;
            padding-top: 15px;
            border-top: 2px solid var(--border);
        }
        
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--accent), var(--highlight));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(15, 52, 96, 0.2);
        }
        
        .btn-success {
            background: linear-gradient(to right, var(--success), #00a085);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(0, 184, 148, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(to right, var(--danger), #c0392b);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(231, 76, 60, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(to right, var(--warning), #f1c40f);
            color: var(--dark);
        }
        
        .btn-warning:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(253, 203, 110, 0.3);
        }
        
        .orders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .order-card {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            border-top: 5px solid var(--accent);
        }
        
        .order-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .order-id {
            font-weight: 700;
            color: var(--primary);
            font-size: 18px;
        }
        
        .order-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-pending {
            background-color: var(--warning);
            color: var(--dark);
        }
        
        .status-preparing {
            background-color: var(--accent);
            color: white;
        }
        
        .status-ready {
            background-color: var(--success);
            color: white;
        }
        
        .status-paid {
            background-color: var(--success);
            color: white;
        }
        
        .status-cancelled {
            background-color: var(--danger);
            color: white;
        }
        
        .order-details {
            margin-bottom: 20px;
        }
        
        .order-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .order-info-item {
            display: flex;
            flex-direction: column;
        }
        
        .order-info-label {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 3px;
        }
        
        .order-info-value {
            font-weight: 600;
        }
        
        .order-items-list {
            margin-top: 10px;
        }
        
        .order-item-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dashed var(--border);
        }
        
        .order-item-row:last-child {
            border-bottom: none;
        }
        
        .order-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .order-actions .btn {
            padding: 10px;
            font-size: 14px;
        }
        
        .hidden {
            display: none;
        }
        
        /* Print Styles for Thermal Printer */
        @media print {
            body * {
                visibility: hidden;
            }
            #receipt-print, #receipt-print * {
                visibility: visible;
            }
            #receipt-print {
                position: absolute;
                left: 0;
                top: 0;
                width: 80mm !important;
                padding: 5mm !important;
                background: white !important;
                color: black !important;
                font-size: 16pt !important;
                font-weight: bold !important;
                line-height: 1.2 !important;
                font-family: 'Courier New', monospace !important;
            }
            .no-print {
                display: none !important;
            }
            @page {
                margin: 0;
                size: 80mm auto;
            }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .products-container {
                grid-template-columns: 1fr;
            }
            
            .orders-grid {
                grid-template-columns: 1fr;
            }
            
            .location-buttons {
                flex-direction: column;
            }
            
            .order-actions {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-utensils logo-icon"></i>
                    <span>Paşam Döner - Garson Paneli</span>
                </div>
                <div class="current-time" id="current-time"></div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="new-order">
                <i class="fas fa-plus-circle"></i>
                Yeni Sipariş
            </div>
            <div class="nav-tab" data-tab="orders">
                <i class="fas fa-list-alt"></i>
                Tüm Siparişler
            </div>
            <div class="nav-tab" data-tab="paid-orders">
                <i class="fas fa-check-circle"></i>
                Ödendi
            </div>
            <div class="nav-tab" data-tab="cancelled-orders">
                <i class="fas fa-times-circle"></i>
                İptal Edilenler
            </div>
        </div>
        
        <!-- Yeni Sipariş Tab -->
        <div class="tab-content active" id="new-order">
            <h2 class="section-title">
                <i class="fas fa-cash-register"></i>
                Yeni Sipariş Oluştur
            </h2>
            
            <div class="location-buttons">
                <button class="location-btn active" data-location="inside">
                    <i class="fas fa-chair"></i>
                    <span>İç Mekan</span>
                </button>
                <button class="location-btn" data-location="outside">
                    <i class="fas fa-motorcycle"></i>
                    <span>Dış Mekan</span>
                </button>
            </div>
            
            <!-- İç Mekan Formu -->
            <div class="location-section active" id="inside-section">
                <div class="form-group">
                    <label for="table-number"><i class="fas fa-table"></i> Masa Numarası</label>
                    <input type="number" id="table-number" min="1" max="50" placeholder="Masa numarasını girin">
                </div>
                <div class="form-group">
                    <label for="inside-notes"><i class="fas fa-sticky-note"></i> Müşteri Notu</label>
                    <textarea id="inside-notes" rows="3" placeholder="Müşteri notunu girin"></textarea>
                </div>
            </div>
            
            <!-- Dış Mekan Formu -->
            <div class="location-section" id="outside-section">
                <div class="form-group">
                    <label for="customer-name"><i class="fas fa-user"></i> Müşteri Adı</label>
                    <input type="text" id="customer-name" placeholder="Müşteri adını girin">
                </div>
                <div class="form-group">
                    <label for="customer-phone"><i class="fas fa-phone"></i> Telefon Numarası</label>
                    <input type="tel" id="customer-phone" placeholder="Telefon numarasını girin">
                </div>
                <div class="form-group">
                    <label for="customer-address"><i class="fas fa-map-marker-alt"></i> Adres</label>
                    <textarea id="customer-address" rows="3" placeholder="Adresi girin"></textarea>
                </div>
                <div class="form-group">
                    <label for="courier-name"><i class="fas fa-motorcycle"></i> Kurye Adı</label>
                    <input type="text" id="courier-name" placeholder="Kurye adını girin">
                </div>
                <div class="form-group">
                    <label for="outside-notes"><i class="fas fa-sticky-note"></i> Müşteri Notu</label>
                    <textarea id="outside-notes" rows="3" placeholder="Müşteri notunu girin"></textarea>
                </div>
            </div>
            
            <h3 class="section-title">
                <i class="fas fa-utensils"></i>
                Ürünler
            </h3>
            <div class="products-container" id="products-container">
                <!-- Ürünler buraya JavaScript ile eklenecek -->
            </div>
            
            <div class="order-summary">
                <h3><i class="fas fa-receipt"></i> Sipariş Özeti</h3>
                <div class="order-items" id="order-items">
                    <!-- Sipariş öğeleri buraya eklenecek -->
                </div>
                <div class="order-total">
                    <span>Toplam:</span>
                    <span id="order-total">0.00 TL</span>
                </div>
            </div>
            
            <button class="btn btn-success" id="save-order">
                <i class="fas fa-save"></i>
                Siparişi Kaydet
            </button>
        </div>
        
        <!-- Tüm Siparişler Tab -->
        <div class="tab-content" id="orders">
            <h2 class="section-title">
                <i class="fas fa-list-alt"></i>
                Bekleyen Siparişler
            </h2>
            <div class="orders-grid" id="orders-container">
                <!-- Sipariş kartları buraya JavaScript ile eklenecek -->
            </div>
        </div>
        
        <!-- Ödendi Tab -->
        <div class="tab-content" id="paid-orders">
            <h2 class="section-title">
                <i class="fas fa-check-circle"></i>
                Ödenen Siparişler
            </h2>
            <div class="orders-grid" id="paid-orders-container">
                <!-- Ödenen siparişler buraya eklenecek -->
            </div>
        </div>
        
        <!-- İptal Edilenler Tab -->
        <div class="tab-content" id="cancelled-orders">
            <h2 class="section-title">
                <i class="fas fa-times-circle"></i>
                İptal Edilen Siparişler
            </h2>
            <div class="orders-grid" id="cancelled-orders-container">
                <!-- İptal edilen siparişler buraya eklenecek -->
            </div>
        </div>
    </div>

    <!-- Fiş Yazdırma Bölümü (Gizli) -->
    <div id="receipt-print" class="hidden"></div>

    <script>
        // Sayfa yüklendiğinde çalışacak fonksiyon
        document.addEventListener('DOMContentLoaded', function() {
            // Saati güncelle
            updateTime();
            setInterval(updateTime, 1000);
            
            // Ürünleri yükle
            loadProducts();
            
            // Tab geçişleri
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Tüm tabları ve içerikleri deaktif et
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Tıklanan tabı aktif et
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                    
                    // İlgili siparişleri yükle
                    if (tabId === 'orders') {
                        loadOrders('pending');
                    } else if (tabId === 'paid-orders') {
                        loadOrders('paid');
                    } else if (tabId === 'cancelled-orders') {
                        loadOrders('cancelled');
                    }
                });
            });
            
            // Konum butonları
            document.querySelectorAll('.location-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.location-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.location-section').forEach(s => s.classList.remove('active'));
                    
                    this.classList.add('active');
                    const location = this.getAttribute('data-location');
                    document.getElementById(`${location}-section`).classList.add('active');
                    
                    // Konuma göre ürünleri filtrele
                    filterProductsByLocation(location);
                });
            });
            
            // Sipariş kaydet butonu
            document.getElementById('save-order').addEventListener('click', saveOrder);
        });
        
        // Saati güncelleme fonksiyonu
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('tr-TR');
            const dateString = now.toLocaleDateString('tr-TR');
            document.getElementById('current-time').textContent = `${dateString} ${timeString}`;
        }
        
        // Ürünleri yükleme fonksiyonu
        function loadProducts() {
            // localStorage'dan ürünleri al
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const productsContainer = document.getElementById('products-container');
            
            productsContainer.innerHTML = '';
            
            if (products.length === 0) {
                productsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-box-open" style="font-size: 48px; margin-bottom: 15px; color: #ddd;"></i>
                        <p>Henüz ürün eklenmemiş.</p>
                    </div>
                `;
                return;
            }
            
            // Ürünleri konumlarına göre grupla
            const insideProducts = products.filter(p => p.location === 'inside' || p.location === 'both');
            const outsideProducts = products.filter(p => p.location === 'outside' || p.location === 'both');
            
            // İç mekan ürünleri
            if (insideProducts.length > 0) {
                const insideCategory = document.createElement('div');
                insideCategory.className = 'product-category';
                insideCategory.innerHTML = `
                    <div class="category-title">İç Mekan Ürünleri</div>
                    <div class="products-grid" id="inside-products">
                        ${insideProducts.map(product => createProductCard(product)).join('')}
                    </div>
                `;
                productsContainer.appendChild(insideCategory);
            }
            
            // Dış mekan ürünleri
            if (outsideProducts.length > 0) {
                const outsideCategory = document.createElement('div');
                outsideCategory.className = 'product-category';
                outsideCategory.innerHTML = `
                    <div class="category-title">Dış Mekan Ürünleri</div>
                    <div class="products-grid" id="outside-products">
                        ${outsideProducts.map(product => createProductCard(product)).join('')}
                    </div>
                `;
                productsContainer.appendChild(outsideCategory);
            }
            
            // Ürün butonlarına event listener ekle
            document.querySelectorAll('.add-product-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = this.getAttribute('data-id');
                    addProductToOrder(productId);
                });
            });
            
            // Miktar butonlarına event listener ekle
            document.querySelectorAll('.quantity-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = this.closest('.product-card').getAttribute('data-id');
                    const isIncrease = this.classList.contains('increase');
                    updateProductQuantity(productId, isIncrease);
                });
            });
        }
        
        // Ürün kartı oluşturma fonksiyonu
        function createProductCard(product) {
            return `
                <div class="product-card" data-id="${product.id}">
                    <div class="product-header">
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">${product.price} TL</div>
                    </div>
                    <div class="product-controls">
                        <div class="quantity-controls">
                            <button class="quantity-btn decrease">-</button>
                            <div class="quantity-display" id="quantity-${product.id}">0</div>
                            <button class="quantity-btn increase">+</button>
                        </div>
                        <button class="add-product-btn" data-id="${product.id}">
                            <i class="fas fa-cart-plus"></i>
                            Ekle
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Konuma göre ürünleri filtreleme fonksiyonu
        function filterProductsByLocation(location) {
            const productsContainer = document.getElementById('products-container');
            const insideCategory = productsContainer.querySelector('#inside-products');
            const outsideCategory = productsContainer.querySelector('#outside-products');
            
            if (location === 'inside') {
                if (insideCategory) insideCategory.style.display = 'grid';
                if (outsideCategory) outsideCategory.style.display = 'none';
            } else {
                if (insideCategory) insideCategory.style.display = 'none';
                if (outsideCategory) outsideCategory.style.display = 'grid';
            }
        }
        
        // Ürünü siparişe ekleme fonksiyonu
        function addProductToOrder(productId) {
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const product = products.find(p => p.id == productId);
            
            if (!product) return;
            
            // Mevcut siparişi al
            const currentOrder = JSON.parse(localStorage.getItem('currentOrder')) || { items: [] };
            
            // Ürün zaten ekli mi kontrol et
            const existingItem = currentOrder.items.find(item => item.id == productId);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                currentOrder.items.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: 1
                });
            }
            
            // Siparişi localStorage'a kaydet
            localStorage.setItem('currentOrder', JSON.stringify(currentOrder));
            
            // Sipariş özetini güncelle
            updateOrderSummary();
            
            // Ürün miktarını güncelle
            updateProductQuantityDisplay(productId);
        }
        
        // Ürün miktarını güncelleme fonksiyonu
        function updateProductQuantity(productId, isIncrease) {
            const currentOrder = JSON.parse(localStorage.getItem('currentOrder')) || { items: [] };
            const existingItem = currentOrder.items.find(item => item.id == productId);
            
            if (existingItem) {
                if (isIncrease) {
                    existingItem.quantity += 1;
                } else {
                    existingItem.quantity -= 1;
                    if (existingItem.quantity <= 0) {
                        currentOrder.items = currentOrder.items.filter(item => item.id != productId);
                    }
                }
            } else if (isIncrease) {
                const products = JSON.parse(localStorage.getItem('products')) || [];
                const product = products.find(p => p.id == productId);
                
                if (product) {
                    currentOrder.items.push({
                        id: product.id,
                        name: product.name,
                        price: product.price,
                        quantity: 1
                    });
                }
            }
            
            // Siparişi localStorage'a kaydet
            localStorage.setItem('currentOrder', JSON.stringify(currentOrder));
            
            // Sipariş özetini güncelle
            updateOrderSummary();
            
            // Ürün miktarını güncelle
            updateProductQuantityDisplay(productId);
        }
        
        // Ürün miktarını görüntüleme fonksiyonu
        function updateProductQuantityDisplay(productId) {
            const currentOrder = JSON.parse(localStorage.getItem('currentOrder')) || { items: [] };
            const existingItem = currentOrder.items.find(item => item.id == productId);
            const quantityDisplay = document.getElementById(`quantity-${productId}`);
            
            if (quantityDisplay) {
                quantityDisplay.textContent = existingItem ? existingItem.quantity : 0;
            }
        }
        
        // Sipariş özetini güncelleme fonksiyonu
        function updateOrderSummary() {
            const currentOrder = JSON.parse(localStorage.getItem('currentOrder')) || { items: [] };
            const orderItems = document.getElementById('order-items');
            let total = 0;
            
            orderItems.innerHTML = '';
            
            if (currentOrder.items.length === 0) {
                orderItems.innerHTML = '<p style="text-align: center; color: #777; padding: 20px;">Henüz ürün eklenmemiş</p>';
                document.getElementById('order-total').textContent = '0.00 TL';
                return;
            }
            
            currentOrder.items.forEach(item => {
                const itemTotal = parseFloat(item.price) * item.quantity;
                total += itemTotal;
                
                const orderItem = document.createElement('div');
                orderItem.className = 'order-item';
                orderItem.innerHTML = `
                    <div class="order-item-info">
                        <div class="order-item-name">${item.name}</div>
                        <div class="order-item-price">${item.price} TL x ${item.quantity}</div>
                    </div>
                    <div class="order-item-controls">
                        <div class="order-item-quantity">${itemTotal.toFixed(2)} TL</div>
                        <button class="remove-item-btn" data-id="${item.id}">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                orderItems.appendChild(orderItem);
            });
            
            document.getElementById('order-total').textContent = `${total.toFixed(2)} TL`;
            
            // Kaldır butonlarına event listener ekle
            document.querySelectorAll('.remove-item-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = this.getAttribute('data-id');
                    removeProductFromOrder(productId);
                });
            });
        }
        
        // Ürünü siparişten kaldırma fonksiyonu
        function removeProductFromOrder(productId) {
            const currentOrder = JSON.parse(localStorage.getItem('currentOrder')) || { items: [] };
            currentOrder.items = currentOrder.items.filter(item => item.id != productId);
            localStorage.setItem('currentOrder', JSON.stringify(currentOrder));
            
            updateOrderSummary();
            updateProductQuantityDisplay(productId);
        }
        
        // Sipariş kaydetme fonksiyonu
        function saveOrder() {
            const location = document.querySelector('.location-btn.active').getAttribute('data-location');
            const currentOrder = JSON.parse(localStorage.getItem('currentOrder')) || { items: [] };
            
            if (currentOrder.items.length === 0) {
                alert('Lütfen en az bir ürün seçin!');
                return;
            }
            
            // Düzenlenen sipariş ID'sini kontrol et
            const editingOrderId = localStorage.getItem('editingOrderId');
            
            // Sipariş detaylarını topla
            const orderDetails = {
                id: editingOrderId ? parseInt(editingOrderId) : Date.now(), // Mevcut siparişi düzenle veya yeni oluştur
                date: new Date().toISOString(),
                location: location,
                items: [...currentOrder.items],
                total: currentOrder.items.reduce((sum, item) => sum + (parseFloat(item.price) * item.quantity), 0),
                status: 'pending',
                paymentMethod: 'not-selected'
            };
            
            // İç mekan bilgileri
            if (location === 'inside') {
                orderDetails.tableNumber = document.getElementById('table-number').value;
                orderDetails.customerNote = document.getElementById('inside-notes').value;
                
                if (!orderDetails.tableNumber) {
                    alert('Lütfen masa numarasını girin!');
                    return;
                }
            }
            // Dış mekan bilgileri
            else {
                orderDetails.customerName = document.getElementById('customer-name').value;
                orderDetails.customerPhone = document.getElementById('customer-phone').value;
                orderDetails.customerAddress = document.getElementById('customer-address').value;
                orderDetails.courierName = document.getElementById('courier-name').value;
                orderDetails.customerNote = document.getElementById('outside-notes').value;
                
                if (!orderDetails.customerName || !orderDetails.customerPhone || !orderDetails.customerAddress) {
                    alert('Lütfen müşteri bilgilerini eksiksiz doldurun!');
                    return;
                }
            }
            
            // Siparişleri localStorage'a kaydet
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            
            if (editingOrderId) {
                // Mevcut siparişi güncelle
                const orderIndex = orders.findIndex(order => order.id === parseInt(editingOrderId));
                if (orderIndex !== -1) {
                    // Tarihi ve durumu koru, diğer bilgileri güncelle
                    orderDetails.date = orders[orderIndex].date;
                    orderDetails.status = orders[orderIndex].status;
                    orderDetails.paymentMethod = orders[orderIndex].paymentMethod;
                    orders[orderIndex] = orderDetails;
                }
                localStorage.removeItem('editingOrderId');
            } else {
                // Yeni sipariş ekle
                orders.push(orderDetails);
            }
            
            localStorage.setItem('orders', JSON.stringify(orders));
            
            // Geçerli siparişi temizle
            localStorage.removeItem('currentOrder');
            
            // Formu temizle
            resetForm();
            
            alert(editingOrderId ? 'Sipariş başarıyla güncellendi!' : 'Sipariş başarıyla kaydedildi!');
            
            // Siparişler tabına geç
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector('[data-tab="orders"]').classList.add('active');
            document.getElementById('orders').classList.add('active');
            
            // Siparişleri yükle
            loadOrders('pending');
        }
        
        // Formu sıfırlama fonksiyonu
        function resetForm() {
            document.getElementById('table-number').value = '';
            document.getElementById('inside-notes').value = '';
            document.getElementById('customer-name').value = '';
            document.getElementById('customer-phone').value = '';
            document.getElementById('customer-address').value = '';
            document.getElementById('courier-name').value = '';
            document.getElementById('outside-notes').value = '';
            
            // Tüm ürün miktarlarını sıfırla
            document.querySelectorAll('.quantity-display').forEach(display => {
                display.textContent = '0';
            });
            
            updateOrderSummary();
        }
        
        // Siparişleri yükleme fonksiyonu
        function loadOrders(status) {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            let containerId, filteredOrders;
            
            switch(status) {
                case 'pending':
                    containerId = 'orders-container';
                    filteredOrders = orders.filter(order => order.status === 'pending' && order.paymentMethod === 'not-selected');
                    break;
                case 'paid':
                    containerId = 'paid-orders-container';
                    filteredOrders = orders.filter(order => order.paymentMethod === 'cash' || order.paymentMethod === 'card');
                    break;
                case 'cancelled':
                    containerId = 'cancelled-orders-container';
                    filteredOrders = orders.filter(order => order.status === 'cancelled');
                    break;
                default:
                    containerId = 'orders-container';
                    filteredOrders = orders.filter(order => order.status === 'pending');
            }
            
            const ordersContainer = document.getElementById(containerId);
            
            ordersContainer.innerHTML = '';
            
            if (filteredOrders.length === 0) {
                ordersContainer.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <i class="fas fa-clipboard-list" style="font-size: 48px; margin-bottom: 15px; color: #ddd;"></i>
                        <p>Henüz sipariş bulunmuyor.</p>
                    </div>
                `;
                return;
            }
            
            // Siparişleri ters kronolojik sırayla göster (en yeni en üstte)
            filteredOrders.reverse().forEach(order => {
                const orderCard = document.createElement('div');
                orderCard.className = 'order-card';
                orderCard.setAttribute('data-id', order.id);
                
                // Durum etiketi
                let statusText = '';
                let statusClass = '';
                
                switch(order.status) {
                    case 'pending':
                        statusText = 'Beklemede';
                        statusClass = 'status-pending';
                        break;
                    case 'preparing':
                        statusText = 'Hazırlanıyor';
                        statusClass = 'status-preparing';
                        break;
                    case 'ready':
                        statusText = 'Hazır';
                        statusClass = 'status-ready';
                        break;
                    case 'cancelled':
                        statusText = 'İptal Edildi';
                        statusClass = 'status-cancelled';
                        break;
                }
                
                // Ödeme durumu
                let paymentStatusText = '';
                let paymentStatusClass = '';
                
                if (order.paymentMethod === 'cash' || order.paymentMethod === 'card') {
                    paymentStatusText = 'Ödendi';
                    paymentStatusClass = 'status-paid';
                } else if (order.status === 'cancelled') {
                    paymentStatusText = 'İptal Edildi';
                    paymentStatusClass = 'status-cancelled';
                } else {
                    paymentStatusText = 'Ödeme Bekliyor';
                    paymentStatusClass = 'status-pending';
                }
                
                // Tarih formatı
                const orderDate = new Date(order.date);
                const dateString = orderDate.toLocaleDateString('tr-TR');
                const timeString = orderDate.toLocaleTimeString('tr-TR');
                
                // Konum bilgisi
                let locationInfo = '';
                if (order.location === 'inside') {
                    locationInfo = `Masa ${order.tableNumber}`;
                } else {
                    locationInfo = `${order.customerName}`;
                }
                
                // Ödeme yöntemi
                let paymentText = '';
                switch(order.paymentMethod) {
                    case 'cash':
                        paymentText = 'Nakit';
                        break;
                    case 'card':
                        paymentText = 'Kart';
                        break;
                    default:
                        paymentText = 'Seçilmedi';
                }
                
                // Ürün listesi
                let itemsHtml = '';
                order.items.forEach(item => {
                    itemsHtml += `
                        <div class="order-item-row">
                            <span>${item.name} x ${item.quantity}</span>
                            <span>${(parseFloat(item.price) * item.quantity).toFixed(2)} TL</span>
                        </div>
                    `;
                });
                
                // Yazdır butonunu sadece "Tüm Siparişler" sayfasında göster
                const showPrintButton = status === 'pending';
                
                orderCard.innerHTML = `
                    <div class="order-header">
                        <div class="order-id">Sipariş #${order.id}</div>
                        <div class="order-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="order-details">
                        <div class="order-info">
                            <div class="order-info-item">
                                <span class="order-info-label">Konum</span>
                                <span class="order-info-value">${order.location === 'inside' ? 'İç Mekan' : 'Dış Mekan'}</span>
                            </div>
                            <div class="order-info-item">
                                <span class="order-info-label">${order.location === 'inside' ? 'Masa' : 'Müşteri'}</span>
                                <span class="order-info-value">${locationInfo}</span>
                            </div>
                            <div class="order-info-item">
                                <span class="order-info-label">Tarih</span>
                                <span class="order-info-value">${dateString}</span>
                            </div>
                            <div class="order-info-item">
                                <span class="order-info-label">Saat</span>
                                <span class="order-info-value">${timeString}</span>
                            </div>
                            <div class="order-info-item">
                                <span class="order-info-label">Ödeme</span>
                                <span class="order-info-value">${paymentText}</span>
                            </div>
                            <div class="order-info-item">
                                <span class="order-info-label">Durum</span>
                                <span class="order-info-value ${paymentStatusClass}">${paymentStatusText}</span>
                            </div>
                            <div class="order-info-item">
                                <span class="order-info-label">Toplam</span>
                                <span class="order-info-value">${order.total.toFixed(2)} TL</span>
                            </div>
                        </div>
                        <div class="order-items-list">
                            ${itemsHtml}
                        </div>
                        ${order.customerNote ? `<div style="margin-top: 10px;"><strong>Not:</strong> ${order.customerNote}</div>` : ''}
                    </div>
                    <div class="order-actions">
                        ${status === 'pending' ? `
                            <button class="btn btn-success" onclick="updatePaymentMethod(${order.id}, 'cash')">
                                <i class="fas fa-money-bill-wave"></i>
                                Nakit Öde
                            </button>
                            <button class="btn btn-primary" onclick="updatePaymentMethod(${order.id}, 'card')">
                                <i class="fas fa-credit-card"></i>
                                Kart ile Öde
                            </button>
                            <button class="btn btn-warning" onclick="addMoreItems(${order.id})">
                                <i class="fas fa-plus"></i>
                                Sipariş Ekle
                            </button>
                            <button class="btn btn-danger" onclick="cancelOrder(${order.id})">
                                <i class="fas fa-times"></i>
                                İptal
                            </button>
                            ${showPrintButton ? `
                            <button class="btn" style="background: var(--dark); color: white;" onclick="printReceipt(${order.id})">
                                <i class="fas fa-print"></i>
                                Yazdır
                            </button>
                            ` : ''}
                        ` : ''}
                    </div>
                `;
                
                ordersContainer.appendChild(orderCard);
            });
        }
        
        // Ödeme yöntemini güncelleme fonksiyonu
        function updatePaymentMethod(orderId, method) {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const orderIndex = orders.findIndex(order => order.id === orderId);
            
            if (orderIndex !== -1) {
                orders[orderIndex].paymentMethod = method;
                localStorage.setItem('orders', JSON.stringify(orders));
                loadOrders('pending');
                
                alert(`Ödeme yöntemi ${method === 'cash' ? 'Nakit' : 'Kart'} olarak güncellendi.`);
            }
        }
        
        // Siparişe ürün ekleme fonksiyonu
        function addMoreItems(orderId) {
            // Mevcut siparişi bul
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const orderIndex = orders.findIndex(order => order.id === orderId);
            
            if (orderIndex !== -1) {
                // Siparişi geçerli sipariş olarak ayarla
                localStorage.setItem('currentOrder', JSON.stringify({ items: orders[orderIndex].items }));
                localStorage.setItem('editingOrderId', orderId);
                
                // Yeni sipariş tabına geç
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.querySelector('[data-tab="new-order"]').classList.add('active');
                document.getElementById('new-order').classList.add('active');
                
                // Konumu ayarla
                const location = orders[orderIndex].location;
                document.querySelectorAll('.location-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.location-section').forEach(s => s.classList.remove('active'));
                document.querySelector(`[data-location="${location}"]`).classList.add('active');
                document.getElementById(`${location}-section`).classList.add('active');
                
                // Form alanlarını doldur
                if (location === 'inside') {
                    document.getElementById('table-number').value = orders[orderIndex].tableNumber;
                    document.getElementById('inside-notes').value = orders[orderIndex].customerNote || '';
                } else {
                    document.getElementById('customer-name').value = orders[orderIndex].customerName;
                    document.getElementById('customer-phone').value = orders[orderIndex].customerPhone;
                    document.getElementById('customer-address').value = orders[orderIndex].customerAddress;
                    document.getElementById('courier-name').value = orders[orderIndex].courierName || '';
                    document.getElementById('outside-notes').value = orders[orderIndex].customerNote || '';
                }
                
                // Sipariş özetini güncelle
                updateOrderSummary();
                
                // Ürün miktarlarını güncelle
                orders[orderIndex].items.forEach(item => {
                    updateProductQuantityDisplay(item.id);
                });
                
                alert('Sipariş düzenleme moduna geçildi. Ürün ekleyip tekrar kaydedin.');
            }
        }
        
        // Sipariş iptal etme fonksiyonu
        function cancelOrder(orderId) {
            if (confirm('Bu siparişi iptal etmek istediğinizden emin misiniz?')) {
                const orders = JSON.parse(localStorage.getItem('orders')) || [];
                const orderIndex = orders.findIndex(order => order.id === orderId);
                
                if (orderIndex !== -1) {
                    orders[orderIndex].status = 'cancelled';
                    localStorage.setItem('orders', JSON.stringify(orders));
                    loadOrders('pending');
                }
            }
        }
        
        // Fiş yazdırma fonksiyonu
        function printReceipt(orderId) {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const order = orders.find(o => o.id === orderId);
            
            if (!order) return;
            
            // Tarih formatı
            const orderDate = new Date(order.date);
            const dateString = orderDate.toLocaleDateString('tr-TR');
            const timeString = orderDate.toLocaleTimeString('tr-TR');
            
            // Fiş içeriği - 80mm termal yazıcı için optimize edilmiş
            let receiptContent = `
                <div style="font-family: 'Courier New', monospace; width: 100mm; padding: 5mm; font-size: 16pt; font-weight: bold; line-height: 1.2; color: black;">
                    <div style="text-align: center; margin-bottom: 10px;">
                        <div style="font-size: 20pt; font-weight: bold;">PAŞAM DÖNER</div>
                        <div style="font-size: 14pt;">ADİSYON</div>
                    </div>
                    <hr style="border-top: 2px solid black; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                        <span>Tarih:</span>
                        <span>${dateString}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                        <span>Saat:</span>
                        <span>${timeString}</span>
                    </div>
            `;
            
            // Konum bilgileri
            if (order.location === 'inside') {
                receiptContent += `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Masa:</span>
                        <span>${order.tableNumber}</span>
                    </div>
                `;
            } else {
                receiptContent += `
                    <div style="margin-bottom: 10px;">
                        <div style="font-weight: bold;">Müşteri:</div>
                        <div>${order.customerName}</div>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <div style="font-weight: bold;">Adres:</div>
                        <div>${order.customerAddress}</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                        <span>Telefon:</span>
                        <span>${order.customerPhone}</span>
                    </div>
                    ${order.courierName ? `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Kurye:</span>
                        <span>${order.courierName}</span>
                    </div>
                    ` : ''}
                `;
            }
            
            receiptContent += `
                    <hr style="border-top: 1px dashed black; margin: 10px 0;">
            `;
            
            // Ürünler
            order.items.forEach(item => {
                const itemTotal = (parseFloat(item.price) * item.quantity).toFixed(2);
                receiptContent += `
                    <div style="margin-bottom: 8px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>${item.name}</span>
                            <span>${itemTotal} TL</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 14pt;">
                            <span>${item.price} TL x ${item.quantity}</span>
                        </div>
                    </div>
                `;
            });
            
            // Not kısmı (toplamdan önce)
            if (order.customerNote) {
                receiptContent += `
                    <hr style="border-top: 1px dashed black; margin: 10px 0;">
                    <div style="margin-bottom: 10px;">
                        <div style="font-weight: bold;">NOT:</div>
                        <div style="font-size: 14pt;">${order.customerNote}</div>
                    </div>
                `;
            }
            
            // Toplam (en altta)
            receiptContent += `
                    <hr style="border-top: 1px dashed black; margin: 10px 0;">
                    <div style="display: flex; justify-content: space-between; font-size: 18pt; margin-bottom: 10px;">
                        <span>TOPLAM:</span>
                        <span>${order.total.toFixed(2)} TL</span>
                    </div>
                    <hr style="border-top: 2px solid black; margin: 10px 0;">
                    <div style="text-align: center; font-size: 14pt; margin-top: 15px;">
                        Teşekkür ederiz,<br>yine bekleriz!
                    </div>
                </div>
            `;
            
            // Yazdırma bölümünü güncelle
            const receiptPrint = document.getElementById('receipt-print');
            receiptPrint.innerHTML = receiptContent;
            receiptPrint.classList.remove('hidden');
            
            // Yazdır
            window.print();
            
            // Yazdırma bölümünü tekrar gizle
            setTimeout(() => {
                receiptPrint.classList.add('hidden');
            }, 100);
        }
        
        // Sayfa yüklendiğinde sipariş özetini güncelle
        updateOrderSummary();
    </script>
</body>
</html>